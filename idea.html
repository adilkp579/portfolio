<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>IdeaShare â€” HTML</title>
<style>
  :root{
    --bg:#f7fafc; --panel:#ffffff; --muted:#6b7280; --accent1:#6366f1; --accent2:#8b5cf6; --ring:rgba(99,102,241,.15);
    --card-shadow: 0 6px 18px rgba(15,23,42,.06);
    --radius:16px;
  }
  :root[data-theme="dark"]{
    --bg:#0b1220; --panel:#0f1724; --muted:#9ca3af; --accent1:#7c3aed; --accent2:#4f46e5; --ring: rgba(124,58,237,.12);
    --card-shadow: 0 6px 18px rgba(2,6,23,.6);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    background:var(--bg); color: #0f1724; -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale; padding:18px;
  }
  :root[data-theme="dark"] body{ color: #e6eef8 }

  .container{max-width:1100px; margin:0 auto; display:grid; gap:18px; grid-template-columns:1fr}
  header{display:flex; justify-content:space-between; align-items:center; gap:12px}
  h1{margin:0;font-size:22px}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  .top-actions{display:flex; gap:8px; align-items:center}
  button{cursor:pointer;border:0;background:transparent}
  .btn{
    display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:12px;
    background:linear-gradient(90deg,var(--accent1),var(--accent2)); color:white; font-weight:600;
    box-shadow: 0 6px 18px rgba(99,102,241,.12);
  }
  .ghost{padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(0,0,0,.06)}
  :root[data-theme="dark"] .ghost{border-color: rgba(255,255,255,.06)}

  main{display:grid; grid-template-columns: 320px 1fr; gap:18px}
  @media (max-width:880px){
    main{grid-template-columns:1fr}
    .sidebar{order:2}
    .ideas{order:1}
  }

  .panel{background:var(--panel); border-radius:var(--radius); padding:14px; box-shadow:var(--card-shadow); border:1px solid rgba(0,0,0,0.03)}
  :root[data-theme="dark"] .panel{border-color: rgba(255,255,255,0.03)}

  form input, form textarea, .control{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(0,0,0,0.06);
    background:transparent; color:inherit; font-size:14px;
  }
  :root[data-theme="dark"] form input, :root[data-theme="dark"] form textarea, :root[data-theme="dark"] .control{border-color: rgba(255,255,255,0.06)}

  textarea{min-height:92px; resize:vertical}
  .small{font-size:12px;color:var(--muted)}

  .tag{display:inline-block;padding:6px 8px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);font-size:12px;margin:6px 6px 0 0}
  :root[data-theme="dark"] .tag{border-color: rgba(255,255,255,0.06)}

  .flex{display:flex; gap:10px; align-items:center}
  .space-y{display:flex;flex-direction:column; gap:10px}

  .ideas-list{display:flex; flex-direction:column; gap:12px}
  .idea-card{display:flex; gap:12px; align-items:flex-start; padding:12px; border-radius:12px; background:var(--panel); box-shadow:var(--card-shadow); border:1px solid rgba(0,0,0,0.03)}
  .avatar{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;background:linear-gradient(135deg,var(--accent1),var(--accent2));flex-shrink:0}
  .idea-body{flex:1}
  .meta{font-size:12px;color:var(--muted)}
  .title{font-weight:700;margin:0;font-size:16px}
  .desc{margin:8px 0 0;color:var(--muted);font-size:14px;line-height:1.35}

  .controls{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .control-btn{padding:6px 10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06); background:transparent;font-size:13px}
  :root[data-theme="dark"] .control-btn{border-color: rgba(255,255,255,0.06)}

  .vote{display:flex; align-items:center; gap:6px; border-radius:10px; padding:6px 8px; border:1px solid rgba(0,0,0,0.06)}
  .count{min-width:36px;text-align:center;font-weight:700}

  /* modal */
  .modal-back{position:fixed; inset:0;background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:40}
  .modal{width:95%;max-width:720px;background:var(--panel); border-radius:12px;padding:14px; border:1px solid rgba(0,0,0,0.05)}
  :root[data-theme="dark"] .modal{border-color: rgba(255,255,255,0.04)}
  .comments-list{display:flex;flex-direction:column; gap:8px; margin-top:12px}
  .comment{display:flex; gap:10px; align-items:flex-start; padding:8px; border-radius:10px; border:1px solid rgba(0,0,0,0.03)}
  :root[data-theme="dark"] .comment{border-color: rgba(255,255,255,0.03)}

  footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

  .empty{padding:18px;border-radius:12px;text-align:center;color:var(--muted);border:1px dashed rgba(0,0,0,0.06)}
  :root[data-theme="dark"] .empty{border-color: rgba(255,255,255,0.04)}
</style>
</head>
<body>
<div class="container" id="app">
  <header>
    <div>
      <h1>IdeaShare</h1>
      <p class="lead">Share ideas, vote, comment and build together.</p>
    </div>
    <div class="top-actions">
      <div class="small" id="welcome">Welcome</div>
      <button id="themeToggle" class="ghost" title="Toggle theme">ðŸŒ™</button>
    </div>
  </header>

  <main>
    <!-- Sidebar -->
    <aside class="panel sidebar">
      <form id="ideaForm" class="space-y" autocomplete="off">
        <div class="small">Share an idea</div>
        <input id="title" placeholder="Title (required)" required />
        <textarea id="description" placeholder="Description (required)"></textarea>
        <input id="tags" placeholder="Tags (comma separated) e.g. community, security" />
        <div class="flex">
          <button class="btn" type="submit">Post idea</button>
          <button type="button" id="resetForm" class="control-btn">Reset</button>
        </div>

        <div style="border-top:1px dashed rgba(0,0,0,0.06); padding-top:10px">
          <input id="search" placeholder="Search ideas..." class="control" />
          <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
            <select id="sort" class="control" style="max-width:160px;">
              <option value="recent">Most Recent</option>
              <option value="votes">Top Voted</option>
            </select>
            <select id="tagFilter" class="control" style="max-width:160px;">
              <option value="">All tags</option>
            </select>
          </div>
          <div style="margin-top:8px" class="small">Hot tags:</div>
          <div id="hotTags" style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap"></div>
        </div>
      </form>
      <div style="margin-top:10px" class="small">Saved ideas: <span id="savedCount">0</span></div>
    </aside>

    <!-- Ideas -->
    <section class="ideas">
      <div class="panel" style="display:flex; align-items:center; justify-content:space-between;">
        <div style="font-weight:700">Ideas</div>
        <div class="small" id="resultCount">0 results</div>
      </div>

      <div id="ideasList" class="ideas-list" style="margin-top:12px"></div>
      <div id="empty" class="empty" style="display:none">No ideas yet â€” post one!</div>
    </section>
  </main>

  <footer class="small">IdeaShare â€” local demo â€¢ Data stored in your browser</footer>
</div>

<!-- Comments modal -->
<div id="modal" class="modal-back" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document" aria-labelledby="modalTitle">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <div>
        <div id="modalTitle" style="font-weight:700"></div>
        <div class="meta" id="modalMeta"></div>
      </div>
      <div style="display:flex; gap:8px;">
        <button id="copyLink" class="control-btn">Copy link</button>
        <button id="closeModal" class="control-btn">Close</button>
      </div>
    </div>

    <p id="modalDesc" style="margin-top:10px;color:var(--muted)"></p>
    <div style="margin-top:10px">
      <div style="display:flex; gap:8px;">
        <input id="commentInput" placeholder="Write a comment..." />
        <button id="sendComment" class="btn">Reply</button>
      </div>
      <div id="commentsList" class="comments-list"></div>
    </div>
  </div>
</div>

<script>
/* Utility and state */
const LS_KEY = 'ideas_v1';
const LS_THEME = 'theme_v1';
const LS_SAVED = 'saved_v1';

function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }
function nowISO(){ return new Date().toISOString(); }
function timeAgo(iso){
  const s = Math.floor((Date.now() - new Date(iso).getTime())/1000);
  if(s < 60) return s + 's';
  const m = Math.floor(s/60);
  if(m < 60) return m + 'm';
  const h = Math.floor(m/60);
  if(h < 24) return h + 'h';
  const d = Math.floor(h/24);
  if(d < 30) return d + 'd';
  return new Date(iso).toLocaleDateString();
}

let ideas = JSON.parse(localStorage.getItem(LS_KEY) || 'null') || [
  { id: uid('idea'), title:'Make monthly meetups', description:'Organize monthly practical web security labs.', tags:['community','security'], votes:12, comments:[], createdAt: nowISO(), author:'Adil' },
  { id: uid('idea'), title:'Campus mentorship', description:'Pair seniors with juniors for guided learning.', tags:['education','mentorship'], votes:8, comments:[], createdAt: nowISO(), author:'Guest' },
];
let saved = JSON.parse(localStorage.getItem(LS_SAVED) || '[]');
let theme = localStorage.getItem(LS_THEME) || (window.matchMedia && window.matchMedia('(prefers-color-scheme:dark)').matches ? 'dark' : 'light');

const elements = {
  ideasList: document.getElementById('ideasList'),
  ideaForm: document.getElementById('ideaForm'),
  title: document.getElementById('title'),
  description: document.getElementById('description'),
  tags: document.getElementById('tags'),
  resetForm: document.getElementById('resetForm'),
  search: document.getElementById('search'),
  sort: document.getElementById('sort'),
  tagFilter: document.getElementById('tagFilter'),
  hotTags: document.getElementById('hotTags'),
  savedCount: document.getElementById('savedCount'),
  resultCount: document.getElementById('resultCount'),
  empty: document.getElementById('empty'),
  themeToggle: document.getElementById('themeToggle'),
  welcome: document.getElementById('welcome'),
  modalBack: document.getElementById('modal'),
  modalTitle: document.getElementById('modalTitle'),
  modalDesc: document.getElementById('modalDesc'),
  modalMeta: document.getElementById('modalMeta'),
  commentsList: document.getElementById('commentsList'),
  commentInput: document.getElementById('commentInput'),
  sendComment: document.getElementById('sendComment'),
  closeModal: document.getElementById('closeModal'),
  copyLink: document.getElementById('copyLink'),
  tagFilterSelect: document.getElementById('tagFilter'),
  searchInput: document.getElementById('search'),
  sortSelect: document.getElementById('sort'),
  hotTagsContainer: document.getElementById('hotTags'),
};

function persist(){ localStorage.setItem(LS_KEY, JSON.stringify(ideas)); localStorage.setItem(LS_SAVED, JSON.stringify(saved)); }
function setTheme(t){
  theme = t;
  document.documentElement.setAttribute('data-theme', t==='dark' ? 'dark' : 'light');
  localStorage.setItem(LS_THEME, t);
  elements.themeToggle.textContent = t==='dark' ? 'â˜€ï¸' : 'ðŸŒ™';
}
setTheme(theme);

/* UI helpers */
function initials(name){
  if(!name) return 'U';
  return name.split(' ').map(x=>x[0]).slice(0,2).join('').toUpperCase();
}
function uniqueTags(){
  const s = new Set();
  ideas.forEach(i=>i.tags.forEach(t=>s.add(t)));
  return [...s];
}
function updateTagsUI(){
  // tag filter select
  const tags = uniqueTags();
  elements.tagFilterSelect.innerHTML = '<option value="">All tags</option>';
  tags.forEach(t=> { const op = document.createElement('option'); op.value = t; op.textContent = t; elements.tagFilterSelect.appendChild(op); });

  // hot tags
  elements.hotTagsContainer.innerHTML = '';
  tags.slice(0,8).forEach(t=>{
    const b = document.createElement('button'); b.className='tag'; b.textContent='#' + t;
    b.addEventListener('click', ()=> { elements.tagFilterSelect.value = t; render(); });
    elements.hotTagsContainer.appendChild(b);
  });
}

function render(){
  const q = elements.searchInput.value.trim().toLowerCase();
  const tagF = elements.tagFilterSelect.value;
  const sort = elements.sortSelect.value;

  let list = ideas.slice();
  if(tagF) list = list.filter(i => i.tags.includes(tagF));
  if(q) list = list.filter(i => (i.title + ' ' + i.description).toLowerCase().includes(q));
  if(sort === 'recent') list.sort((a,b)=> new Date(b.createdAt)-new Date(a.createdAt));
  else if(sort === 'votes') list.sort((a,b)=> b.votes - a.votes);

  elements.ideasList.innerHTML = '';
  if(list.length === 0){
    elements.empty.style.display = 'block';
  } else elements.empty.style.display = 'none';

  list.forEach(idea => {
    const card = document.createElement('article');
    card.className = 'idea-card';

    const avatar = document.createElement('div');
    avatar.className = 'avatar';
    avatar.textContent = initials(idea.author || 'A');

    const body = document.createElement('div');
    body.className = 'idea-body';

    const top = document.createElement('div');
    top.style.display='flex'; top.style.justifyContent='space-between'; top.style.alignItems='center';

    const left = document.createElement('div');
    const t = document.createElement('h3'); t.className='title'; t.textContent = idea.title;
    const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = `by ${idea.author || 'Anonymous'} â€¢ ${timeAgo(idea.createdAt)}`;
    left.appendChild(t); left.appendChild(meta);

    const right = document.createElement('div'); right.style.display='flex'; right.style.alignItems='center'; right.style.gap='8px';
    const voteBox = document.createElement('div'); voteBox.className='vote';
    const up = document.createElement('button'); up.className='control-btn'; up.textContent='â–²';
    up.title='Upvote'; up.addEventListener('click', ()=> { idea.votes++; persist(); render(); });
    const count = document.createElement('div'); count.className='count'; count.textContent = idea.votes;
    const down = document.createElement('button'); down.className='control-btn'; down.textContent='â–¼';
    down.title='Downvote'; down.addEventListener('click', ()=> { idea.votes = Math.max(0, idea.votes-1); persist(); render(); });

    voteBox.appendChild(up); voteBox.appendChild(count); voteBox.appendChild(down);
    right.appendChild(voteBox);

    top.appendChild(left); top.appendChild(right);

    const desc = document.createElement('p'); desc.className='desc'; desc.textContent = idea.description;

    const tagWrap = document.createElement('div');
    idea.tags.forEach(tg => {
      const s = document.createElement('span'); s.className='tag'; s.textContent = '#'+tg; tagWrap.appendChild(s);
    });

    const controls = document.createElement('div'); controls.className='controls';
    const commentsBtn = document.createElement('button'); commentsBtn.className='control-btn'; commentsBtn.textContent = `Comments (${idea.comments.length})`;
    commentsBtn.addEventListener('click', ()=> openModal(idea.id));
    const saveBtn = document.createElement('button'); saveBtn.className='control-btn'; saveBtn.textContent = saved.includes(idea.id) ? 'Saved' : 'Save';
    saveBtn.addEventListener('click', ()=> { toggleSave(idea.id); render(); });
    const shareBtn = document.createElement('button'); shareBtn.className='control-btn'; shareBtn.textContent='Share';
    shareBtn.addEventListener('click', ()=> {
      const url = location.href.split('#')[0] + '#'+idea.id;
      navigator.clipboard && navigator.clipboard.writeText(url);
      alert('Link copied to clipboard');
    });

    controls.appendChild(commentsBtn); controls.appendChild(saveBtn); controls.appendChild(shareBtn);

    body.appendChild(top);
    body.appendChild(desc);
    body.appendChild(tagWrap);
    body.appendChild(controls);

    card.appendChild(avatar); card.appendChild(body);
    elements.ideasList.appendChild(card);
  });

  elements.resultCount.textContent = `${list.length} results`;
  elements.savedCount.textContent = saved.length;
  updateTagsUI();
}

/* Form handling */
elements.ideaForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  const title = elements.title.value.trim();
  const desc = elements.description.value.trim();
  const tags = elements.tags.value.split(',').map(s=>s.trim().toLowerCase()).filter(Boolean);
  if(!title || !desc) { alert('Please add title and description'); return; }
  const newIdea = { id: uid('idea'), title, description: desc, tags, votes:0, comments:[], createdAt: nowISO(), author: 'Anonymous' };
  ideas.unshift(newIdea);
  persist();
  elements.ideaForm.reset();
  render();
});

elements.resetForm.addEventListener('click', ()=> elements.ideaForm.reset());

elements.searchInput.addEventListener('input', debounce(()=> render(), 180));
elements.sortSelect.addEventListener('change', ()=> render());
elements.tagFilterSelect.addEventListener('change', ()=> render());

function debounce(fn, ms=150){
  let t;
  return function(...a){ clearTimeout(t); t = setTimeout(()=> fn.apply(this,a), ms); };
}

/* Saved */
function toggleSave(id){
  if(saved.includes(id)) saved = saved.filter(x=>x!==id);
  else saved.unshift(id);
  persist();
}

/* Modal handling */
let activeIdeaId = null;
function openModal(id){
  activeIdeaId = id;
  const idea = ideas.find(i=>i.id===id);
  if(!idea) return;
  elements.modalTitle.textContent = idea.title;
  elements.modalDesc.textContent = idea.description;
  elements.modalMeta.textContent = `by ${idea.author || 'Anonymous'} â€¢ ${timeAgo(idea.createdAt)}`;
  renderComments(idea);
  elements.modalBack.style.display = 'flex';
  elements.modalBack.setAttribute('aria-hidden','false');
  // update URL hash
  history.replaceState(null, '', '#'+id);
}
function closeModal(){
  activeIdeaId = null;
  elements.modalBack.style.display = 'none';
  elements.modalBack.setAttribute('aria-hidden','true');
  history.replaceState(null,'', location.pathname + location.search);
}
elements.closeModal.addEventListener('click', closeModal);
elements.modalBack.addEventListener('click', (e)=> { if(e.target === elements.modalBack) closeModal(); });

function renderComments(idea){
  elements.commentsList.innerHTML = '';
  if(!idea.comments || idea.comments.length===0) {
    elements.commentsList.innerHTML = '<div class="small" style="color:var(--muted)">No comments yet</div>';
    return;
  }
  idea.comments.forEach(c=>{
    const node = document.createElement('div'); node.className='comment';
    const av = document.createElement('div'); av.className='avatar'; av.style.width='36px'; av.style.height='36px'; av.style.fontSize='13px'; av.textContent = initials(c.author || 'U');
    const b = document.createElement('div'); b.style.flex='1';
    const top = document.createElement('div'); top.style.display='flex'; top.style.justifyContent='space-between'; top.style.alignItems='center';
    const name = document.createElement('div'); name.style.fontWeight='700'; name.style.fontSize='13px'; name.textContent = c.author || 'You';
    const timeEl = document.createElement('div'); timeEl.className='meta'; timeEl.textContent = timeAgo(c.createdAt);
    const text = document.createElement('div'); text.style.marginTop='6px'; text.textContent = c.text;
    top.appendChild(name); top.appendChild(timeEl);
    b.appendChild(top); b.appendChild(text);
    const del = document.createElement('button'); del.className='control-btn'; del.textContent='Delete';
    del.addEventListener('click', ()=> { idea.comments = idea.comments.filter(x=>x.id !== c.id); persist(); renderComments(idea); render(); });
    node.appendChild(av); node.appendChild(b); node.appendChild(del);
    elements.commentsList.appendChild(node);
  });
}

/* add comment */
elements.sendComment.addEventListener('click', ()=>{
  const text = elements.commentInput.value.trim();
  if(!text) return;
  const idea = ideas.find(i=>i.id===activeIdeaId);
  if(!idea) return;
  idea.comments.push({ id: uid('c'), text, createdAt: nowISO(), author: 'You' });
  elements.commentInput.value = '';
  persist();
  renderComments(idea);
  render();
});

/* copy link */
elements.copyLink.addEventListener('click', ()=>{
  if(!activeIdeaId) return;
  const url = location.href.split('#')[0] + '#'+activeIdeaId;
  navigator.clipboard && navigator.clipboard.writeText(url);
  alert('Link copied to clipboard');
});

/* theme toggle */
elements.themeToggle.addEventListener('click', ()=> {
  setTheme(theme === 'dark' ? 'light' : 'dark');
});

/* keyboard shortcuts (n = new idea focus, / = search) */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'n' && document.activeElement.tagName.toLowerCase() !== 'input' && document.activeElement.tagName.toLowerCase() !== 'textarea'){
    elements.title.focus();
  }
  if(e.key === '/' && document.activeElement.tagName.toLowerCase() !== 'input' && document.activeElement.tagName.toLowerCase() !== 'textarea'){
    e.preventDefault(); elements.searchInput.focus();
  }
});

/* initial render & persist */
updateTagsUI();
render();
persist();

/* greet user if name known (localStorage optional) */
elements.welcome.textContent = 'Welcome, Adil';

/* deep-link: if URL contains hash, open that idea */
window.addEventListener('load', ()=>{
  const h = location.hash.replace('#','');
  if(h){
    const found = ideas.find(i=>i.id === h);
    if(found) setTimeout(()=> openModal(found.id), 300);
  }
});
</script>
</body>
</html>
